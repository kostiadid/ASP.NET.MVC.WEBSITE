(function(a){a.fn.disableSelection_dropotron=function(){return a(this).css("user-select","none").css("-khtml-user-select","none").css("-moz-user-select","none").css("-o-user-select","none").css("-webkit-user-select","none")},a.fn.dropotron=function(p){if(this.length==0)return a(this);if(this.length>1)for(var e=0;e<this.length;e++)a(this[e]).dropotron(p);return a.dropotron(a.extend({selectorParent:a(this)},p))},a.dropotron=function(p){var e=a.extend({selectorParent:null,baseZIndex:1e3,menuClass:"dropotron",expandMode:"hover",hoverDelay:150,hideDelay:250,openerClass:"opener",openerActiveClass:"active",submenuClassPrefix:"level-",mode:"fade",speed:"fast",easing:"swing",alignment:"left",offsetX:0,offsetY:0,globalOffsetY:0,IEOffsetX:0,IEOffsetY:0,noOpenerFade:!0,detach:!0,cloneOnDetach:!0},p),d=e.selectorParent,u=d.find("ul"),x=a("body"),k=a("body,html"),h=a(window),l=!1,m=null,g=null;d.on("doCollapseAll",function(){u.trigger("doCollapse")}),u.each(function(){var t=a(this),o=t.parent();e.hideDelay>0&&t.add(o).on("mouseleave",function(n){window.clearTimeout(g),g=window.setTimeout(function(){t.trigger("doCollapse")},e.hideDelay)}),t.disableSelection_dropotron().hide().addClass(e.menuClass).css("position","absolute").on("mouseenter",function(n){window.clearTimeout(g)}).on("doExpand",function(){if(t.is(":visible"))return!1;window.clearTimeout(g),u.each(function(){var w=a(this);a.contains(w.get(0),o.get(0))||w.trigger("doCollapse")});var n,i,s,r,A=o.offset(),v=o.position(),C=(o.parent().position(),o.outerWidth()),c=t.outerWidth(),b=t.css("z-index")==e.baseZIndex;if(b){switch(n=e.detach?A:v,r=n.top+o.outerHeight()+e.globalOffsetY,i=e.alignment,t.removeClass("left").removeClass("right").removeClass("center"),e.alignment){case"right":s=n.left-c+C,0>s&&(s=n.left,i="left");break;case"center":s=n.left-Math.floor((c-C)/2),0>s?(s=n.left,i="left"):s+c>h.width()&&(s=n.left-c+C,i="right");break;case"left":default:s=n.left,s+c>h.width()&&(s=n.left-c+C,i="right")}t.addClass(i)}else switch(o.css("position")=="relative"||o.css("position")=="absolute"?(r=e.offsetY,s=-1*v.left):(r=v.top+e.offsetY,s=0),e.alignment){case"right":s+=-1*o.parent().outerWidth()+e.offsetX;break;case"center":case"left":default:s+=o.parent().outerWidth()+e.offsetX}navigator.userAgent.match(/MSIE ([0-9]+)\./)&&RegExp.$1<8&&(s+=e.IEOffsetX,r+=e.IEOffsetY),t.css("left",s+"px").css("top",r+"px").css("opacity","0.01").show();var f=!1;switch(s=o.css("position")=="relative"||o.css("position")=="absolute"?-1*v.left:0,t.offset().left<0?(s+=o.parent().outerWidth()-e.offsetX,f=!0):t.offset().left+c>h.width()&&(s+=-1*o.parent().outerWidth()-e.offsetX,f=!0),f&&t.css("left",s+"px"),t.hide().css("opacity","1"),e.mode){case"zoom":l=!0,o.addClass(e.openerActiveClass),t.animate({width:"toggle",height:"toggle"},e.speed,e.easing,function(){l=!1});break;case"slide":l=!0,o.addClass(e.openerActiveClass),t.animate({height:"toggle"},e.speed,e.easing,function(){l=!1});break;case"fade":if(l=!0,b&&!e.noOpenerFade){var f;f=e.speed=="slow"?80:e.speed=="fast"?40:Math.floor(e.speed/2),o.fadeTo(f,.01,function(){o.addClass(e.openerActiveClass),o.fadeTo(e.speed,1),t.fadeIn(e.speed,function(){l=!1})})}else o.addClass(e.openerActiveClass),o.fadeTo(e.speed,1),t.fadeIn(e.speed,function(){l=!1});break;case"instant":default:o.addClass(e.openerActiveClass),t.show()}return!1}).on("doCollapse",function(){return t.is(":visible")&&(t.hide(),o.removeClass(e.openerActiveClass),t.find("."+e.openerActiveClass).removeClass(e.openerActiveClass),t.find("ul").hide()),!1}).on("doToggle",function(n){return t.is(":visible")?t.trigger("doCollapse"):t.trigger("doExpand"),!1}),o.disableSelection_dropotron().addClass("opener").css("cursor","pointer").on("click touchend",function(n){l||(n.preventDefault(),n.stopPropagation(),t.trigger("doToggle"))}),e.expandMode=="hover"&&o.hover(function(n){l||(m=window.setTimeout(function(){t.trigger("doExpand")},e.hoverDelay))},function(n){window.clearTimeout(m)})}),u.find("a").css("display","block").on("click touchend",function(t){l||a(this).attr("href").length<1&&t.preventDefault()}),d.find("li").css("white-space","nowrap").each(function(){var t=a(this),o=t.children("a"),n=t.children("ul"),i=o.attr("href");o.on("click touchend",function(s){i.length==0||i=="#"?s.preventDefault():s.stopPropagation()}),o.length>0&&n.length==0&&t.on("click touchend",function(s){l||(d.trigger("doCollapseAll"),s.stopPropagation())})}),d.children("li").each(function(){var t,o=a(this),n=o.children("ul");if(n.length>0){e.detach&&(e.cloneOnDetach&&(t=n.clone(),t.attr("class","").hide().appendTo(n.parent())),n.detach().appendTo(x));for(var i=e.baseZIndex,s=1,r=n;r.length>0;s++)r.css("z-index",i++),e.submenuClassPrefix&&r.addClass(e.submenuClassPrefix+(i-1-e.baseZIndex)),r=r.find("> li > ul")}}),h.on("scroll",function(){d.trigger("doCollapseAll")}).on("keypress",function(t){l||t.keyCode!=27||(t.preventDefault(),d.trigger("doCollapseAll"))}),k.on("click touchend",function(){l||d.trigger("doCollapseAll")})}})(jQuery);
